!function(){var t=window.SER_MAGIA_SHEET_CSV_URL||"https://docs.google.com/spreadsheets/d/e/2PACX-1vSNJARxZ_CBiwnjGUDOonIqTqRp8xjrtfhltQRp-ptEbcga2Qxb9Apg2ecALLLM8g/pub?output=csv",e=window.SER_MAGIA_SHEET_LECTURAS_CSV_URL||"";if(t&&0===t.indexOf("http")){var n=Date.now(),o=t.indexOf("?")>-1?"&":"?";if(t=t+o+"t="+n,e&&0===e.indexOf("http")){var r=e.indexOf("?")>-1?"&":"?";e=e+r+"t="+n}if(window.AGENDA_LOADER_PROMISE=fetch(t,{cache:"no-store"}).then(t=>{if(!t.ok)throw new Error("HTTP "+t.status);return t.text()}).then(e=>{const n=c(e,s(t)).filter(t=>""!==(t.titulo||"").trim()).map(u);return n.length?(window.AGENDA_EVENTOS=n,console.info("[Agenda Loader] âœ… Eventos cargados desde Google Sheets:",n.length),console.table(n),window.dispatchEvent(new CustomEvent("agendaUpdated",{detail:n})),n):(console.warn("[Agenda Loader] Sheet vÃ¡lida pero sin eventos. Usando fallback."),null)}).catch(t=>(console.error("[Agenda Loader] âŒ Error al cargar CSV:",t),console.error("[Agenda Loader] VerificÃ¡ que la hoja estÃ© publicada y la URL sea correcta."),null)),window.location.hostname.match(/localhost|127\.0\.0\.1/)||setInterval(function(){var e=t.split("&t=")[0]+"&t="+Date.now();fetch(e,{cache:"no-store"}).then(t=>t.text()).then(e=>{const n=c(e,s(t)).filter(t=>""!==(t.titulo||"").trim()).map(u);n.length&&JSON.stringify(n)!==JSON.stringify(window.AGENDA_EVENTOS)&&(window.AGENDA_EVENTOS=n,console.info("[Agenda Loader] ðŸ”„ Eventos actualizados automÃ¡ticamente:",n.length),window.dispatchEvent(new CustomEvent("agendaUpdated",{detail:n})))}).catch(function(){})},3e4),e&&0===e.indexOf("http")){function a(t){return{lectura:(t.lectura||t.Lectura||"").trim(),precio:(t.precio||t.Precio||"").trim(),dur:(t.duracion||t.DuraciÃ³n||t.duracion_min||"").trim()}}function i(t){t=(t||"").trim();try{t=t.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}catch(t){}return t.toLowerCase()}window.LECTURAS_LOADER_PROMISE=fetch(e,{cache:"no-store"}).then(function(t){if(!t.ok)throw new Error("HTTP "+t.status);return t.text()}).then(function(t){var n=c(t,s(e)).filter(function(t){return""!==(t.lectura||t.Lectura||"").trim()}).map(a);console.table(n);var o={};return n.forEach(function(t){t.lectura&&(o[i(t.lectura)]={precio:t.precio,dur:t.dur})}),console.info("[Agenda Loader] ðŸ”‘ Claves de lecturas:",Object.keys(o)),window.LECTURAS_PRECIOS=o,console.info("[Agenda Loader] âœ… Lecturas cargadas desde Sheets:",Object.keys(o).length),window.dispatchEvent(new CustomEvent("lecturasUpdated",{detail:o})),o}).catch(function(t){return console.warn("[Agenda Loader] Lecturas CSV no disponible:",t),null}),window.location.hostname.match(/localhost|127\.0\.0\.1/)||setInterval(function(){var t=e.split("&t=")[0]+"&t="+Date.now();fetch(t,{cache:"no-store"}).then(function(t){return t.text()}).then(function(t){var n=c(t,s(e)).filter(function(t){return""!==(t.lectura||t.Lectura||"").trim()}).map(a),o={};n.forEach(function(t){t.lectura&&(o[i(t.lectura)]={precio:t.precio,dur:t.dur})}),JSON.stringify(o)!==JSON.stringify(window.LECTURAS_PRECIOS||{})&&(window.LECTURAS_PRECIOS=o,console.info("[Agenda Loader] ðŸ”„ Lecturas actualizadas automÃ¡ticamente:",Object.keys(o).length),window.dispatchEvent(new CustomEvent("lecturasUpdated",{detail:o})))}).catch(function(){})},3e4)}}else console.warn("[Agenda Loader] SHEET_CSV_URL no configurada. Usando eventos por defecto definidos en app.js.");function c(t,e){e=e||",";const n=t.trim().split(/\r?\n/),o=n[0].split(e).map(t=>t.trim());return n.slice(1).map(t=>{const n=[];let r="",a=!1;for(let o=0;o<t.length;o++){const i=t[o];'"'!==i||'"'!==t[o+1]?'"'!==i?i!==e||a?r+=i:(n.push(r),r=""):a=!a:(r+='"',o++)}n.push(r);const i={};return o.forEach((t,e)=>i[t]=(n[e]||"").trim()),i})}function s(t){try{return/output=tsv|format=tsv/i.test(t)?"\t":","}catch(t){return","}}function u(t){var e=(t.fecha||"").trim(),n=(t.hora||"").trim(),o=(t.titulo||"").trim(),r=(t.subtitulo||"").trim(),a=(t.cupos||"").trim(),i=(t.estado||"").trim();return{f:[e,n].filter(Boolean).join(" Â· ")||o,t:o+(r?" â€“ "+r:""),cupos:i||a,reservar:t.link_reservar||"",consultar:t.link_consultar||"",imagen:t.imagen||""}}}();