<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Test - Galer√≠a Ser Magia</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      background: #1a0b2e;
      color: #fff;
    }
    
    h1 { color: #f2bb66; }
    
    .test-section {
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .status {
      padding: 10px 15px;
      border-radius: 8px;
      margin: 10px 0;
      font-weight: 600;
    }
    
    .success { background: rgba(34, 197, 94, 0.2); color: #4ade80; }
    .error { background: rgba(239, 68, 68, 0.2); color: #f87171; }
    .warning { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
    
    button {
      background: #f2bb66;
      color: #1a0b2e;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      margin: 10px 5px 10px 0;
    }
    
    button:hover { background: #f8d09c; }
    
    input {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(0,0,0,0.3);
      color: white;
      font-family: monospace;
      margin: 10px 0;
    }
    
    .gallery-preview {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .gallery-preview img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid rgba(255,255,255,0.2);
    }
    
    code {
      background: rgba(0,0,0,0.4);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.9em;
    }
    
    pre {
      background: rgba(0,0,0,0.4);
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 0.85em;
    }
  </style>
</head>
<body>
  <h1>üß™ Test de Galer√≠a - Ser Magia</h1>
  
  <div class="test-section">
    <h2>1. Test de Google Apps Script API</h2>
    <p>Prob√° si tu API de Google Apps Script est√° funcionando correctamente.</p>
    
    <label>URL de la API:</label>
    <input 
      type="text" 
      id="api-url" 
      placeholder="https://script.google.com/macros/s/YOUR_ID/exec"
      value=""
    />
    
    <button onclick="testAPI()">Probar API</button>
    <div id="api-result"></div>
  </div>
  
  <div class="test-section">
    <h2>2. Test de ID individual de Google Drive</h2>
    <p>Prob√° si un ID de foto de Drive se puede cargar.</p>
    
    <label>ID de la imagen:</label>
    <input 
      type="text" 
      id="image-id" 
      placeholder="1ABC123xyz456"
      value=""
    />
    
    <button onclick="testImageID()">Probar ID</button>
    <div id="id-result"></div>
  </div>
  
  <div class="test-section">
    <h2>3. Test de m√∫ltiples IDs</h2>
    <p>Prob√° varios IDs a la vez (uno por l√≠nea).</p>
    
    <label>IDs de im√°genes (uno por l√≠nea):</label>
    <textarea 
      id="multiple-ids" 
      rows="5" 
      style="width: 100%; padding: 10px; border-radius: 6px; background: rgba(0,0,0,0.3); color: white; font-family: monospace; border: 1px solid rgba(255,255,255,0.2);"
      placeholder="1ABC123xyz456
1DEF789abc123
1GHI456def789"
    ></textarea>
    
    <button onclick="testMultipleIDs()">Probar IDs</button>
    <div id="multiple-result"></div>
  </div>
  
  <div class="test-section">
    <h2>üìñ Instrucciones</h2>
    <p><strong>C√≥mo obtener el ID de una imagen de Google Drive:</strong></p>
    <ol style="line-height: 1.8;">
      <li>Abr√≠ Google Drive y busc√° tu imagen</li>
      <li>Click derecho ‚Üí <strong>"Obtener enlace"</strong></li>
      <li>Asegurate de que sea <strong>"Cualquier persona con el enlace"</strong></li>
      <li>La URL se ve as√≠: <code>https://drive.google.com/file/d/<strong>1ABC123xyz</strong>/view</code></li>
      <li>Copi√° solo la parte marcada en negrita (el ID)</li>
    </ol>
    
    <p style="margin-top: 20px;"><strong>C√≥mo crear una API de Google Apps Script:</strong></p>
    <p>Segu√≠ las instrucciones en <code>README-GALERIA-SETUP.md</code></p>
  </div>

  <script>
    // Test 1: Probar API
    async function testAPI() {
      const url = document.getElementById('api-url').value.trim();
      const resultDiv = document.getElementById('api-result');
      
      if (!url) {
        resultDiv.innerHTML = '<div class="status warning">‚ö†Ô∏è Ingres√° una URL de API</div>';
        return;
      }
      
      resultDiv.innerHTML = '<div class="status">‚è≥ Probando API...</div>';
      
      try {
        const response = await fetch(url, { cache: 'no-store' });
        const contentType = response.headers.get('content-type');
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        if (!contentType || !contentType.includes('application/json')) {
          const text = await response.text();
          throw new Error(`La API no devuelve JSON. Content-Type: ${contentType || 'none'}\n\nDevolvi√≥ HTML o texto plano. Verific√° que el script est√© desplegado correctamente como "Aplicaci√≥n web" con acceso p√∫blico.`);
        }
        
        const data = await response.json();
        
        if (!Array.isArray(data)) {
          throw new Error('La respuesta no es un array');
        }
        
        if (data.length === 0) {
          resultDiv.innerHTML = '<div class="status warning">‚ö†Ô∏è La API funciona pero devuelve un array vac√≠o (sin im√°genes)</div>';
          return;
        }
        
        // Validar formato
        const firstItem = data[0];
        if (!firstItem.url && !firstItem.id) {
          resultDiv.innerHTML = `
            <div class="status warning">‚ö†Ô∏è Las im√°genes no tienen formato correcto</div>
            <p style="margin-top: 10px;">Se esperaba: <code>{"name": "...", "url": "..."}</code></p>
            <p>Se recibi√≥:</p>
            <pre>${JSON.stringify(firstItem, null, 2)}</pre>
          `;
          return;
        }
        
        resultDiv.innerHTML = `
          <div class="status success">‚úÖ API funcionando correctamente - ${data.length} imagen(es) encontrada(s)</div>
          <p style="margin-top: 10px;"><strong>Primeras im√°genes:</strong></p>
          <pre>${JSON.stringify(data.slice(0, 3), null, 2)}</pre>
          <div class="gallery-preview">
            ${data.slice(0, 6).map(img => `
              <div>
                <img src="${img.url || 'https://drive.google.com/uc?export=view&id=' + img.id}" 
                     alt="${img.name || 'Imagen'}"
                     onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 fill=%22red%22%3E‚ùå%3C/text%3E%3C/svg%3E'" />
                <p style="font-size: 0.75em; margin-top: 5px; text-align: center;">${img.name || 'Sin nombre'}</p>
              </div>
            `).join('')}
          </div>
        `;
        
      } catch (error) {
        resultDiv.innerHTML = `
          <div class="status error">‚ùå Error: ${error.message}</div>
          <p style="margin-top: 10px;"><strong>Posibles causas:</strong></p>
          <ul style="margin-left: 20px; line-height: 1.6;">
            <li>El script no est√° desplegado como "Aplicaci√≥n web"</li>
            <li>El acceso no est√° configurado como "Cualquier usuario"</li>
            <li>La URL es incorrecta</li>
            <li>El script tiene errores</li>
          </ul>
        `;
        console.error('Error completo:', error);
      }
    }
    
    // Test 2: Probar ID individual
    function testImageID() {
      const id = document.getElementById('image-id').value.trim();
      const resultDiv = document.getElementById('id-result');
      
      if (!id) {
        resultDiv.innerHTML = '<div class="status warning">‚ö†Ô∏è Ingres√° un ID de imagen</div>';
        return;
      }
      
      const url = `https://drive.google.com/uc?export=view&id=${id}`;
      
      resultDiv.innerHTML = `
        <div class="status success">‚úÖ ID v√°lido - probando carga...</div>
        <p style="margin-top: 10px;">URL generada:</p>
        <pre>${url}</pre>
        <p style="margin-top: 10px;"><strong>Preview:</strong></p>
        <div style="text-align: center; margin-top: 15px;">
          <img 
            src="${url}" 
            alt="Test imagen" 
            style="max-width: 300px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.2);"
            onload="document.getElementById('load-status').innerHTML = '<div class=\\'status success\\'>‚úÖ Imagen cargada correctamente</div>'"
            onerror="document.getElementById('load-status').innerHTML = '<div class=\\'status error\\'>‚ùå Error cargando imagen. Verific√° que:<br/>- El ID sea correcto<br/>- La imagen tenga permisos p√∫blicos (\\'Cualquier persona con el enlace\\')</div>'"
          />
        </div>
        <div id="load-status" style="margin-top: 15px;"></div>
      `;
    }
    
    // Test 3: Probar m√∫ltiples IDs
    function testMultipleIDs() {
      const idsText = document.getElementById('multiple-ids').value.trim();
      const resultDiv = document.getElementById('multiple-result');
      
      if (!idsText) {
        resultDiv.innerHTML = '<div class="status warning">‚ö†Ô∏è Ingres√° al menos un ID</div>';
        return;
      }
      
      const ids = idsText.split('\n').map(id => id.trim()).filter(id => id.length > 0);
      
      if (ids.length === 0) {
        resultDiv.innerHTML = '<div class="status warning">‚ö†Ô∏è No se encontraron IDs v√°lidos</div>';
        return;
      }
      
      const images = ids.map((id, index) => ({
        id,
        url: `https://drive.google.com/uc?export=view&id=${id}`,
        name: `Imagen ${index + 1}`
      }));
      
      resultDiv.innerHTML = `
        <div class="status success">‚úÖ ${ids.length} ID(s) encontrado(s)</div>
        <p style="margin-top: 10px;"><strong>Array para copiar en galeria-vinito.html:</strong></p>
        <pre>const IMAGE_IDS = [
  '${ids.join("',\n  '")}',
];</pre>
        <p style="margin-top: 15px;"><strong>Preview de las im√°genes:</strong></p>
        <div class="gallery-preview">
          ${images.map((img, idx) => `
            <div>
              <img 
                src="${img.url}" 
                alt="${img.name}"
                onerror="this.style.border='2px solid red'; this.alt='‚ùå Error: ID ${idx + 1}'"
              />
              <p style="font-size: 0.7em; margin-top: 5px; text-align: center;">#${idx + 1}</p>
            </div>
          `).join('')}
        </div>
        <p style="margin-top: 15px; font-size: 0.85em; opacity: 0.8;">
          üí° Si alguna imagen muestra borde rojo, ese ID no funciona (verific√° permisos o que el ID sea correcto)
        </p>
      `;
    }
  </script>
</body>
</html>
